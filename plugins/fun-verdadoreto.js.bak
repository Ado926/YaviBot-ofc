const handler = async (m, { conn, text, args, command }) => {
  try {
    // Si no hay texto ni argumento, envÃ­a el mensaje inicial
    if (!text) {
      await m.react('ğŸ²');
      
      await conn.sendMessage(m.chat, {
        text: '*ğŸ² JUEGO DE VERDAD O RETO ğŸ²*\n\nEscribe "verdad" si quieres una pregunta o "reto" si prefieres un desafÃ­o.',
        footer: 'Â¡Elige una opciÃ³n para comenzar!',
        viewOnce: true,
      }, { quoted: m });

      return; // Finaliza si no hay opciÃ³n escrita
    }

    await m.react('âœ¨'); // ReacciÃ³n mientras procesa

    // Definimos listas de preguntas y retos
    const verdades = [
      "Â¿Es verdad que has dicho una mentira muy grande?",
      "Â¿Es verdad que tienes un crush secreto?",
      "Â¿Es verdad que has roto el corazÃ³n de alguien?",
      "Â¿Es verdad que has copiado en un examen?",
      "Â¿Es verdad que te has enamorado de alguien imposible?",
      "Â¿Es verdad que alguna vez te han rechazado en pÃºblico?",
      "Â¿Es verdad que te has enamorado por internet?",
      "Â¿Es verdad que has hecho trampa en un juego?",
    ];

    const retos = [
      "Te reto a enviar un audio diciendo 'te amo' al grupo.",
      "Te reto a ponerte un filtro ridÃ­culo y mandar una foto.",
      "Te reto a bailar durante 30 segundos y subir el video.",
      "Te reto a escribir el nombre de tu crush con la nariz.",
      "Te reto a mandar un sticker sin contexto.",
      "Te reto a contar un secreto que nunca hayas dicho.",
      "Te reto a cambiar tu nombre por 24 horas a 'Soy un crack'",
      "Te reto a cantar tu canciÃ³n favorita sin mÃºsica.",
    ];

    // Limpia y convierte a minÃºsculas el texto recibido
    const opcion = text.trim().toLowerCase();

    let resultado = '';

    // Elige quÃ© hacer segÃºn la opciÃ³n
    if (opcion === 'verdad') {
      resultado = verdades[Math.floor(Math.random() * verdades.length)];
      await m.react('ğŸ—£ï¸');
    } else if (opcion === 'reto') {
      resultado = retos[Math.floor(Math.random() * retos.length)];
      await m.react('ğŸ’ª');
    } else {
      // Si no es opciÃ³n vÃ¡lida, informa
      await conn.sendMessage(m.chat, {
        text: '*âŒ OpciÃ³n no vÃ¡lida.*\n\nEscribe "verdad" o "reto" para jugar.',
      }, { quoted: m });
      return;
    }

    // Responde con la opciÃ³n seleccionada
    await conn.sendMessage(m.chat, {
      text: `*${resultado}*`,
      footer: 'Â¿Te atreves a seguir jugando? Escribe "verdad" o "reto" para continuar.',
      viewOnce: true,
    }, { quoted: m });

    console.log(`âœ… Verdad o Reto enviado a ${m.sender}: ${resultado}`);

  } catch (error) {
    console.error('âŒ Error en Verdad o Reto:', error);
    await conn.sendMessage(m.chat, {
      text: '*ğŸš¨ Ha ocurrido un error, intÃ©ntalo mÃ¡s tarde.*',
    }, { quoted: m });
  }
};

handler.tags = ['fun'];
handler.help = ['verdadoreto'];
handler.command = ['verdadoreto', 'tor', 'vrd'];

export default handler;